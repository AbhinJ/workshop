<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>6. Advanced Routing Queries &mdash; Workshop - FOSS4G 2016 Bonn - Routing with pgRouting</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/my-styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Workshop - FOSS4G 2016 Bonn - Routing with pgRouting" href="../index.html" />
    <link rel="next" title="7. Writing a pl/pgsql Wrapper" href="wrapper.html" />
    <link rel="prev" title="5. pgRouting Algorithms" href="shortest_path.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/pgrouting.png"></span>
          Workshop FOSS4G Bonn</a>
        <span class="navbar-text navbar-version pull-left"><b>2016</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">2. About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about.html#pgrouting">2.1. pgRouting</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#osm2pgrouting">2.2. osm2pgrouting</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#openstreetmap">2.3. OpenStreetMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#openlayers">2.4. OpenLayers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">3. Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#osgeo-live-using-a-usb-stick-or-cd">3.1. OSGeo Live using a USB stick or CD</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#osgeo-live-on-a-virtualbox">3.2. OSGeo Live on a virtualBox</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prepareData.html">4. Prepare Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="prepareData.html#prepare-the-database">4.1. Prepare the database</a></li>
<li class="toctree-l2"><a class="reference internal" href="prepareData.html#get-the-workshop-data">4.2. Get the Workshop Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="prepareData.html#run-osm2pgrouting">4.3. Run osm2pgrouting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="shortest_path.html">5. pgRouting Algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="shortest_path.html#pgr-dijkstra">5.1. pgr_dijkstra</a></li>
<li class="toctree-l2"><a class="reference internal" href="shortest_path.html#pgr-dijkstracost">5.2. pgr_dijkstraCost</a></li>
<li class="toctree-l2"><a class="reference internal" href="shortest_path.html#pgr-astar">5.3. pgr_astar</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">6. Advanced Routing Queries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">6.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modifying-costs">6.2. Modifying Costs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wrapper.html">7. Writing a pl/pgsql Wrapper</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wrapper.html#one-route-geometry">7.1. One Route geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="wrapper.html#wrapping-with-views">7.2. Wrapping with views</a></li>
<li class="toctree-l2"><a class="reference internal" href="wrapper.html#wrapping-with-functions">7.3. Wrapping with functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="geoserver.html">8. WMS server with GeoServer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="geoserver.html#connect-to-the-administration-page">8.1. Connect to the administration page</a></li>
<li class="toctree-l2"><a class="reference internal" href="geoserver.html#create-the-layer">8.2. Create the layer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ol3_client.html">9. OpenLayers 3 Based Routing Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ol3_client.html#openlayers-3-introduction">9.1. OpenLayers 3 introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="ol3_client.html#creating-a-minimal-map">9.2. Creating a minimal map</a></li>
<li class="toctree-l2"><a class="reference internal" href="ol3_client.html#wms-get-parameters">9.3. WMS GET parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="ol3_client.html#select-start-and-destination">9.4. Select &#8220;start&#8221; and &#8220;destination&#8221;</a></li>
<li class="toctree-l2"><a class="reference internal" href="ol3_client.html#clear-the-results">9.5. Clear the results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="topology.html">10. Create a Network Topology</a><ul>
<li class="toctree-l2"><a class="reference internal" href="topology.html#load-network-data">10.1. Load network data</a></li>
<li class="toctree-l2"><a class="reference internal" href="topology.html#create-a-routing-network-topology">10.2. Create a Routing Network Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="topology.html#verify-the-routing-network-topology">10.3. Verify the Routing Network Topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="topology.html#analize-and-adjust-the-routing-network-topology">10.4. Analize and Adjust the Routing Network Topology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="the_solutions.html">11. Apendix: Workshop Solutions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="the_solutions.html#dijkstra-solutions">11.1. <tt class="docutils literal"><span class="pre">dijkstra</span></tt> Solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="the_solutions.html#advanced-solutions">11.2. <tt class="docutils literal"><span class="pre">advanced</span></tt> Solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="the_solutions.html#wrapper-solutions">11.3. <tt class="docutils literal"><span class="pre">wrapper</span></tt> Solutions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="additional-installation.html">12. Apendix: Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="additional-installation.html#pgrouting">12.1. pgRouting</a></li>
<li class="toctree-l2"><a class="reference internal" href="additional-installation.html#pgrouting-workshop">12.2. pgRouting Workshop</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="osm2pgrouting.html">13. Apendix: osm2pgrouting Import Tool</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">6. Advanced Routing Queries</a><ul>
<li><a class="reference internal" href="#introduction">6.1. Introduction</a></li>
<li><a class="reference internal" href="#modifying-costs">6.2. Modifying Costs</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="shortest_path.html" title="Previous Chapter: 5. pgRouting Algorithms"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 5. pgRouting Alg...</span>
    </a>
  </li>
  <li>
    <a href="wrapper.html" title="Next Chapter: 7. Writing a pl/pgsql Wrapper"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">7. Writing a pl/... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="advanced-routing-queries">
<span id="advanced"></span><h1>6. Advanced Routing Queries<a class="headerlink" href="#advanced-routing-queries" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="#intro"><em>Introduction</em></a><ul>
<li><a class="reference internal" href="#exercise-7"><em>Exercise 7</em></a> Single Driver Routing.</li>
<li><a class="reference internal" href="#exercise-8"><em>Exercise 8</em></a> Single Driver Routing: time is money.</li>
</ul>
</li>
<li><a class="reference internal" href="#modify"><em>Modifying Costs</em></a><ul>
<li><a class="reference internal" href="#exercise-9"><em>Exercise 9</em></a> Single Driver Routing encourage on fast road.</li>
<li><a class="reference internal" href="#exercise-10"><em>Exercise 10</em></a> Restricted Access.</li>
</ul>
</li>
</ul>
<div class="section" id="introduction">
<span id="intro"></span><h2>6.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>A query for routing vehicles differs from routing pedestrians explained in the <a class="reference internal" href="shortest_path.html#routing"><em>pgRouting Algorithms</em></a> chapter.</p>
<ul class="simple">
<li>There is a <cite>reverse_cost</cite> involved, and the graph is directed.</li>
<li>This is due to the fact that there are roads that are one way, and depending on the geometry, the valid way is the<ul>
<li>(source, target) segment (<cite>cost</cite> &gt;= 0 and <cite>reverse_cost</cite> &lt; 0)</li>
<li>(target, source) segment (<cite>cost</cite> &lt; 0 and <cite>reverse_cost</cite> &gt;= 0)</li>
<li>So a <cite>wrong way</cite> is indicated with a negative value and is not inserted in the graph for processing.</li>
</ul>
</li>
</ul>
<p>For two way roads <cite>cost</cite> &gt;= 0 and <cite>reverse_cost</cite> &gt;= 0 and their values can be different.
For example its faster going down hill on a sloped road.</p>
<p>In general cost doesn&#8217;t need to be length, cost can be almost anything, for example time, slope, surface, road type, etc..
Or it can be a combination of multiple parameters.</p>
<p>That can be achieved with any SQL possible with postgreSQL/postGIS.</p>
<p>Using the psql client, verify the database tables:</p>
<p class="rubric">Run: <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">count(*)</span> <span class="pre">FROM</span> <span class="pre">ways</span> <span class="pre">WHERE</span> <span class="pre">cost</span> <span class="pre">&lt;</span> <span class="pre">0;</span></tt></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">count</span>
<span class="c1">-------</span>
    <span class="mi">10</span>
<span class="p">(</span><span class="mi">1</span> <span class="k">row</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Run: <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">count(*)</span> <span class="pre">FROM</span> <span class="pre">ways</span> <span class="pre">WHERE</span> <span class="pre">reverse_cost</span> <span class="pre">&lt;</span> <span class="pre">0;</span></tt></p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">count</span>
<span class="c1">-------</span>
  <span class="mi">2238</span>
<span class="p">(</span><span class="mi">1</span> <span class="k">row</span><span class="p">)</span>
</pre></div>
</div>
<div class="topic" id="exercise-7">
<p class="topic-title first">Exercise 7</p>
<p>Single Driver Routing</p>
</div>
<ul class="simple">
<li>Driver “I am in vertex 13224 and want to Drive to vertex 9224. Time based results”</li>
</ul>
<p class="rubric">Problem description</p>
<ul class="simple">
<li>The driver wants to go from vertex 13224 to vertex 9224.</li>
<li>The cost_s and reverse_cost_s columns are terms of <strong>seconds</strong>. But a negative value is used to indicate <cite>wrong way</cite></li>
</ul>
<p class="rubric">Query</p>
<div class="highlight-sql"><div class="highlight"><pre>
</pre></div>
</div>
<p class="rubric">Query Result</p>
<p><a class="reference internal" href="the_solutions.html#sol-7"><em>Solution to Exercise 7</em></a></p>
<div class="topic" id="exercise-8">
<p class="topic-title first">Exercise 8</p>
<p>Single Driver Routing: time is money.</p>
</div>
<ul class="simple">
<li>Driver “I am in vertex 13224 and want to Drive to vertex 9224. I charge $100 per hour”</li>
</ul>
<p class="rubric">Problem description</p>
<ul class="simple">
<li>The driver wants to go from vertex 13224 to vertex 9224.</li>
<li>The cost is $100 per 3600 seconds</li>
<li>The cost_s and reverse_cost_s columns are terms of <strong>seconds</strong>. But a negative value is used to indicate <cite>wrong way</cite></li>
<li>The duration in hours is cost_s / 3600</li>
<li>The cost in $ is cost_s / 3600 * 100</li>
</ul>
<p class="rubric">Query</p>
<div class="highlight-sql"><div class="highlight"><pre>
</pre></div>
</div>
<p class="rubric">Query Result</p>
<p><a class="reference internal" href="the_solutions.html#sol-8"><em>Solution to Exercise 8</em></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Comparing with Exercise 7:</p>
<ul class="last simple">
<li>the total number of records are the same</li>
<li>the node sequence is the same</li>
<li>the edge sequence is the same</li>
<li>the cost and agg_cost reuslts are the directly proportional to the result of Exercise 7</li>
</ul>
</div>
</div>
<div class="section" id="modifying-costs">
<span id="modify"></span><h2>6.2. Modifying Costs<a class="headerlink" href="#modifying-costs" title="Permalink to this headline">¶</a></h2>
<p>In &#8220;real&#8221; networks there are different limitations or preferences for different road types for example. In other words, we don&#8217;t want to get the <em>shortest</em> but the <strong>cheapest</strong> path - a path with a minimal cost. There is no limitation in what we take as costs.</p>
<p>When we convert data from OSM format using the osm2pgrouting tool, we get two additional tables for road <tt class="docutils literal"><span class="pre">osm_way_types</span></tt> and road <tt class="docutils literal"><span class="pre">osm_way_classes</span></tt>:</p>
<p class="rubric">Run: <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">osm_way_types</span> <span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">type_id;</span></tt></p>
<div class="highlight-sql"><div class="highlight"><pre> <span class="n">type_id</span> <span class="o">|</span>   <span class="n">name</span>
<span class="c1">---------+-----------</span>
       <span class="mi">1</span> <span class="o">|</span> <span class="n">highway</span>
       <span class="mi">2</span> <span class="o">|</span> <span class="n">cycleway</span>
       <span class="mi">3</span> <span class="o">|</span> <span class="n">tracktype</span>
       <span class="mi">4</span> <span class="o">|</span> <span class="n">junction</span>
<span class="p">(</span><span class="mi">4</span> <span class="k">rows</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Run: <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">osm_way_classes</span> <span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">class_id;</span></tt></p>
<div class="highlight-sql"><div class="highlight"><pre> <span class="n">class_id</span> <span class="o">|</span> <span class="n">type_id</span> <span class="o">|</span>       <span class="n">name</span>        <span class="o">|</span> <span class="n">priority</span> <span class="o">|</span> <span class="n">default_maxspeed</span>
<span class="c1">----------+---------+-------------------+----------+------------------</span>
      <span class="mi">100</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">road</span>              <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">101</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">motorway</span>          <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">102</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">motorway_link</span>     <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">103</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">motorway_junction</span> <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">104</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">trunk</span>             <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">105</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">trunk_link</span>        <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">106</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="k">primary</span>           <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">107</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">primary_link</span>      <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">108</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">secondary</span>         <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">109</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">tertiary</span>          <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">110</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">residential</span>       <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">111</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">living_street</span>     <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">112</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">service</span>           <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">113</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">track</span>             <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">114</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">pedestrian</span>        <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">115</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">services</span>          <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">116</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">bus_guideway</span>      <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">117</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">path</span>              <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">118</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">cycleway</span>          <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">119</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">footway</span>           <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">120</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">bridleway</span>         <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">121</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">byway</span>             <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">122</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">steps</span>             <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">123</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">unclassified</span>      <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">124</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">secondary_link</span>    <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">125</span> <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span> <span class="n">tertiary_link</span>     <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">201</span> <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span> <span class="n">lane</span>              <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">202</span> <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span> <span class="n">track</span>             <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">203</span> <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span> <span class="n">opposite_lane</span>     <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">204</span> <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span> <span class="n">opposite</span>          <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">301</span> <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span> <span class="n">grade1</span>            <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">302</span> <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span> <span class="n">grade2</span>            <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">303</span> <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span> <span class="n">grade3</span>            <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">304</span> <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span> <span class="n">grade4</span>            <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">305</span> <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span> <span class="n">grade5</span>            <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
      <span class="mi">401</span> <span class="o">|</span>       <span class="mi">4</span> <span class="o">|</span> <span class="n">roundabout</span>        <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>               <span class="mi">50</span>
<span class="p">(</span><span class="mi">36</span> <span class="k">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>The road class is linked with the ways table by <tt class="docutils literal"><span class="pre">class_id</span></tt> field. After importing data the <tt class="docutils literal"><span class="pre">cost</span></tt> attribute is not set yet.
Its values can be changed with an <tt class="docutils literal"><span class="pre">UPDATE</span></tt> query.
In this example cost values for the classes table are assigned so that a circulating on faster roads is encouraged, so we execute:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">osm_way_classes</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">penalty</span> <span class="nb">FLOAT</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;pedestrian&#39;</span><span class="p">,</span><span class="s1">&#39;steps&#39;</span><span class="p">,</span><span class="s1">&#39;footway&#39;</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">1</span><span class="p">.</span><span class="mi">5</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;cicleway&#39;</span><span class="p">,</span><span class="s1">&#39;living_street&#39;</span><span class="p">,</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;secondary&#39;</span><span class="p">,</span><span class="s1">&#39;tertiary&#39;</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;primary&#39;</span><span class="p">,</span><span class="s1">&#39;primary_link&#39;</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">4</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;trunk&#39;</span><span class="p">,</span><span class="s1">&#39;trunk_link&#39;</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">osm_way_classes</span> <span class="k">SET</span> <span class="n">penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;motorway&#39;</span><span class="p">,</span><span class="s1">&#39;motorway_junction&#39;</span><span class="p">,</span><span class="s1">&#39;motorway_link&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The idea behind these two tables is to specify a factor to be multiplied with the cost of each link.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For performance, especially if the network data is large, an index on the <tt class="docutils literal"><span class="pre">class_id</span></tt> field of the <cite>ways</cite> table and <cite>osm_way_classes</cite> table can be created.</p>
<div class="last highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">INDEX</span>  <span class="k">ON</span> <span class="n">ways</span> <span class="p">(</span><span class="n">class_id</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span>  <span class="k">ON</span> <span class="n">osm_way_classes</span> <span class="p">(</span><span class="n">class_id</span><span class="p">);</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">ways</span> <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="k">class</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">class_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">osm_way_classes</span> <span class="p">(</span><span class="n">class_id</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="topic" id="exercise-9">
<p class="topic-title first">Exercise 9</p>
<p>Single Driver Routing encouraged to use faster roads.</p>
</div>
<ul class="simple">
<li>Driver “I am in vertex 13224 and want to Drive to vertex 9224 preferably on faster roads.”</li>
</ul>
<p class="rubric">Problem description</p>
<ul class="simple">
<li>The driver wants to go from vertex 13224 to vertex 9224.</li>
<li>The driver&#8217;s cost is in terms of seconds with a penalty.</li>
</ul>
<p class="rubric">Query</p>
<div class="highlight-sql"><div class="highlight"><pre>
</pre></div>
</div>
<p class="rubric">Query Result</p>
<p><a class="reference internal" href="the_solutions.html#sol-9"><em>Solution to Exercise 9</em></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Comparing with Exercise 7:</p>
<ul class="last simple">
<li>the total number of records changed.</li>
<li>the node sequence changed.</li>
<li>the edge sequence changed.</li>
<li>in othe words a completlty different route was found.</li>
</ul>
</div>
<div class="topic" id="exercise-10">
<p class="topic-title first">Exercise 10</p>
<p>Restricted Access</p>
</div>
<ul class="simple">
<li>Driver “I am in vertex 13224 and want to drive my bus to vertex 9224<ul>
<li>The drivers salary is fixed so it wont affect the decision.</li>
<li>Using the bus is $0.10 per second normally.</li>
<li>The cost of a bus traveling on <cite>residential</cite> roads is $.50 per second, because of permit,</li>
<li>The cost of a bus traveling on any <cite>primary</cite> is $100 per second because of fines.</li>
</ul>
</li>
</ul>
<p class="rubric">Problem description</p>
<ul class="simple">
<li>The driver wants to go from vertex 13224 to vertex 9224.</li>
<li>The driver&#8217;s cost in this case will be in seconds.</li>
<li>Normal Cost = Cost in seconds * $0.10</li>
<li><cite>residential</cite> road cost = Cost in seconds * $0.50</li>
<li>Any <cite>primary</cite> road cost = Cost in seconds * $100</li>
</ul>
<p>Through CASE statements sub queries you can &#8220;mix&#8221; your costs as you like and this will change the results of your routing request immediately.
Cost changes will affect the next shortest path search, and there is no need to rebuild your network.</p>
<p class="rubric">Query</p>
<div class="highlight-sql"><div class="highlight"><pre>
</pre></div>
</div>
<p class="rubric">Query Result</p>
<p><a class="reference internal" href="the_solutions.html#sol-10"><em>Solution to Exercise 10</em></a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2016 Daniel Kastl, Frédéric Junod, Vicky Vergara.<br/>
      Last updated on Aug 05, 2016.<br/>
    </p>
  </div>
</footer>
  </body>
</html>