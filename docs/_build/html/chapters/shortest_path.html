<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>6. pgRouting Shortest Path Search &mdash; Workshop - FOSS4G routing with pgRouting tools, OpenStreetMap road data and GeoExt v1 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Workshop - FOSS4G routing with pgRouting tools, OpenStreetMap road data and GeoExt v1 documentation" href="../index.html" />
    <link rel="next" title="7. Advanced usage of pgRouting shortest path search" href="advanced.html" />
    <link rel="prev" title="5. Load your network data and create a network topology" href="topology.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="advanced.html" title="7. Advanced usage of pgRouting shortest path search"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="topology.html" title="5. Load your network data and create a network topology"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Workshop - FOSS4G routing with pgRouting tools, OpenStreetMap road data and GeoExt v1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="pgrouting-shortest-path-search">
<h1>6. pgRouting Shortest Path Search<a class="headerlink" href="#pgrouting-shortest-path-search" title="Permalink to this headline">¶</a></h1>
<div class="section" id="pgrouting-with-dijkstra-algorithm">
<h2>6.1. pgRouting with Dijkstra algorithm<a class="headerlink" href="#pgrouting-with-dijkstra-algorithm" title="Permalink to this headline">¶</a></h2>
<p>Dijkstra algorithm was the first algorithm implemented in pgRouting. It doesn&#8217;t require more attributes than source and target ID, and it can distinguish between directed and undirected graphs. You can specify if your network has &#8220;reverse cost&#8221; or not.</p>
<dl class="docutils">
<dt>shortest_path( sql text,</dt>
<dd>source_id integer,
target_id integer,
directed boolean,
has_reverse_cost boolean )</dd>
</dl>
<p>Note:</p>
<p>Source and target IDs are vertex IDs.
Undirected graphs (&#8220;directed false&#8221;) ignores &#8220;has_reverse_cost&#8221; setting
Shortest Path Dijkstra core function</p>
<p>Each algorithm has its core function (implementation), which is the base for its wrapper functions.</p>
<dl class="docutils">
<dt>SELECT * FROM shortest_path(&#8216;</dt>
<dd><blockquote class="first">
<dl class="docutils">
<dt>SELECT gid as id,</dt>
<dd><blockquote class="first">
source::integer,
target::integer,
length::double precision as cost</blockquote>
<p class="last">FROM ways&#8217;,</p>
</dd>
</dl>
<p>10, 20, false, false);</p>
</blockquote>
<p class="last">vertex_id | edge_id |        cost</p>
</dd>
<dt>&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</dt>
<dd><blockquote class="first">
<dl class="docutils">
<dt>10 |     293 |  0.0059596293824534</dt>
<dd>9 |    4632 |  0.0846731039249787</dd>
</dl>
</blockquote>
<p>3974 |    4633 |  0.0765635090514303
2107 |    4634 |  0.0763951531894937</p>
<blockquote class="last">
<dl class="docutils">
<dt>... |     ... |  ...</dt>
<dd>20 |      -1 |                   0</dd>
</dl>
</blockquote>
</dd>
</dl>
<p>(63 rows)
Dijkstra Wrapper functions</p>
<p>Wrapper functions extend the core functions with transformations, bounding box limitations, etc..</p>
<p>Wrapper WITHOUT bounding box</p>
<p>Wrappers can change the format and ordering of the result. They often set default function parameters and make the usage of pgRouting more simple.</p>
<dl class="docutils">
<dt>SELECT gid, AsText(the_geom) AS the_geom</dt>
<dd><blockquote class="first">
FROM dijkstra_sp(&#8216;ways&#8217;, 10, 20);</blockquote>
<p class="last">gid   |                              the_geom</p>
</dd>
<dt>&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</dt>
<dd><blockquote class="first">
293 | MULTILINESTRING((18.4074149 -33.9443308,18.4074019 -33.9443833))</blockquote>
<p>4632 | MULTILINESTRING((18.4074149 -33.9443308,18.4077388 -33.9436183))
4633 | MULTILINESTRING((18.4077388 -33.9436183,18.4080293 -33.9429733))</p>
<blockquote class="last">
... | ...
762 | MULTILINESTRING((18.4241422 -33.9179275,18.4237423 -33.9182966))
761 | MULTILINESTRING((18.4243523 -33.9177154,18.4241422 -33.9179275))</blockquote>
</dd>
</dl>
<p>(62 rows)
Wrapper WITH bounding box</p>
<p>You can limit your search area by adding a bounding box. This will improve performance especially for large networks.</p>
<dl class="docutils">
<dt>SELECT gid, AsText(the_geom) AS the_geom</dt>
<dd>FROM dijkstra_sp_delta(&#8216;ways&#8217;, 10, 20, 0.1);</dd>
</dl>
<p>gid | the_geom</p>
<p>293 | MULTILINESTRING((18.4074149 -33.9443308,18.4074019 -33.9443833))</p>
<p>4632 | MULTILINESTRING((18.4074149 -33.9443308,18.4077388 -33.9436183)) 4633 | MULTILINESTRING((18.4077388 -33.9436183,18.4080293 -33.9429733))</p>
<p>... | ... 762 | MULTILINESTRING((18.4241422 -33.9179275,18.4237423 -33.9182966)) 761 | MULTILINESTRING((18.4243523 -33.9177154,18.4241422 -33.9179275))</p>
<p>(62 rows)</p>
<p>Note: The projection of OSM data is &#8220;degree&#8221;, so we set a bounding box containing start and end vertex plus a 0.1 degree buffer for example.</p>
</div>
<div class="section" id="pgrouting-with-a-star-algorithm">
<h2>6.2. pgRouting with A-Star algorithm<a class="headerlink" href="#pgrouting-with-a-star-algorithm" title="Permalink to this headline">¶</a></h2>
<p>A-Star algorithm is another well-known routing algorithm. It adds geographical information to source and target of each network link. This enables the shortest path search to prefer links which are closer to the target of the search.</p>
<p>Prepare routing table for A-Star</p>
<p>For A-Star you need to prepare your network table and add latitute/longitude columns (x1, y1 and x2, y2) and calculate their values.</p>
<p>ALTER TABLE ways ADD COLUMN x1 double precision;
ALTER TABLE ways ADD COLUMN y1 double precision;
ALTER TABLE ways ADD COLUMN x2 double precision;
ALTER TABLE ways ADD COLUMN y2 double precision;
UPDATE ways SET x1 = x(startpoint(the_geom));
UPDATE ways SET y1 = y(startpoint(the_geom));
UPDATE ways SET x2 = x(endpoint(the_geom));
UPDATE ways SET y2 = y(endpoint(the_geom));
Note: &#8220;endpoint()&#8221; function fails for some versions of PostgreSQL (ie. 8.2.5, 8.1.9). A workaround for that problem is using the &#8220;PointN()&#8221; function instead:</p>
<p>UPDATE ways SET x1 = x(PointN(the_geom, 1));
UPDATE ways SET y1 = y(PointN(the_geom, 1));
UPDATE ways SET x2 = x(PointN(the_geom, NumPoints(the_geom)));
UPDATE ways SET y2 = y(PointN(the_geom, NumPoints(the_geom)));
Shortest Path A-Star core function</p>
<p>Shortest Path A-Star function is very similar to the Dijkstra function, though it prefers links that are close to the target of the search. The heuristics of this search are predefined, so you need to recompile pgRouting if you want to make changes to the heuristic function itself.</p>
<dl class="docutils">
<dt>shortest_path_astar( sql text,</dt>
<dd>source_id integer,
target_id integer,
directed boolean,
has_reverse_cost boolean )</dd>
</dl>
<p>Note:</p>
<p>Source and target IDs are vertex IDs.
Undirected graphs (&#8220;directed false&#8221;) ignores &#8220;has_reverse_cost&#8221; setting
Example of A-Star core function</p>
<dl class="docutils">
<dt>SELECT * FROM shortest_path_astar(&#8216;</dt>
<dd><dl class="first docutils">
<dt>SELECT gid as id,</dt>
<dd><blockquote class="first">
source::integer,
target::integer,
length::double precision as cost,
x1, y1, x2, y2</blockquote>
<p class="last">FROM ways&#8217;,</p>
</dd>
</dl>
<p class="last">10, 20, false, false);</p>
</dd>
</dl>
<p>vertex_id | edge_id |        cost
&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</p>
<blockquote>
<blockquote>
<dl class="docutils">
<dt>10 |     293 |  0.0059596293824534</dt>
<dd>9 |    4632 |  0.0846731039249787</dd>
</dl>
</blockquote>
<dl class="docutils">
<dt>3974 |    4633 |  0.0765635090514303</dt>
<dd><dl class="first last docutils">
<dt>... |     ... |  ...</dt>
<dd>20 |      -1 |                   0</dd>
</dl>
</dd>
</dl>
</blockquote>
<p>(63 rows)
Wrapper function WITH bounding box</p>
<p>Wrapper functions extend the core functions with transformations, bounding box limitations, etc..</p>
<dl class="docutils">
<dt>SELECT gid, AsText(the_geom) AS the_geom</dt>
<dd><blockquote class="first">
FROM astar_sp_delta(&#8216;ways&#8217;, 10, 20, 0.1);</blockquote>
<p class="last">gid   |                              the_geom</p>
</dd>
<dt>&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</dt>
<dd><blockquote class="first">
293 | MULTILINESTRING((18.4074149 -33.9443308,18.4074019 -33.9443833))</blockquote>
<p>4632 | MULTILINESTRING((18.4074149 -33.9443308,18.4077388 -33.9436183))
4633 | MULTILINESTRING((18.4077388 -33.9436183,18.4080293 -33.9429733))</p>
<blockquote class="last">
... | ...
762 | MULTILINESTRING((18.4241422 -33.9179275,18.4237423 -33.9182966))
761 | MULTILINESTRING((18.4243523 -33.9177154,18.4241422 -33.9179275))</blockquote>
</dd>
</dl>
<p>(62 rows)
Note:</p>
<p>There is currently no wrapper function for A-Star without bounding box, since bounding boxes are very useful to increase performance. If you don&#8217;t need a bounding box Dijkstra will be enough anyway.
The projection of OSM data is &#8220;degree&#8221;, so we set a bounding box containing start and end vertex plus a 0.1 degree buffer for example.</p>
</div>
<div class="section" id="pgrouting-with-shooting-star-algorithm">
<h2>6.3. pgRouting with Shooting-Star algorithm<a class="headerlink" href="#pgrouting-with-shooting-star-algorithm" title="Permalink to this headline">¶</a></h2>
<p>Shooting-Star algorithm is the latest of pgRouting shortest path algorithms. Its speciality is that it routes from link to link, not from vertex to vertex as Dijkstra and A-Star algorithms do. This makes it possible to define relations between links for example, and it solves some other vertex-based algorithm issues like &#8220;parallel links&#8221;, which have same source and target but different costs.</p>
<p>Prepare routing table for Shooting-Star</p>
<p>For Shooting-Star you need to prepare your network table and add the &#8220;reverse_cost&#8221; and &#8220;to_cost&#8221; column. Like A-Star this algorithm also has a heuristic function, which prefers links closer to the target of the search.</p>
<p>ALTER TABLE ways ADD COLUMN reverse_cost double precision;
UPDATE ways SET reverse_cost = length;
ALTER TABLE ways ADD COLUMN to_cost double precision;
ALTER TABLE ways ADD COLUMN rule text;
Shortest Path Shooting-Star core function</p>
<p>Shooting-Star algorithm introduces two new attributes:</p>
<p>rule: a string with a comma separated list of edge IDs, which describes a rule for turning restriction (if you came along these edges, you can pass through the current one only with the cost stated in to_cost column)
to_cost: a cost of a restricted passage (can be very high in a case of turn restriction or comparable with an edge cost in a case of traffic light)
shortest_path_shooting_star( sql text,</p>
<blockquote>
source_id integer,
target_id integer,
directed boolean,
has_reverse_cost boolean )</blockquote>
<p>Note:</p>
<p>Source and target IDs are link IDs.
Undirected graphs (&#8220;directed false&#8221;) ignores &#8220;has_reverse_cost&#8221; setting
Example for Shooting-Star &#8220;rule&#8221;</p>
<p>Shooting* algorithm calculates a path from edge to edge (not from vertex to vertex). Column vertex_id contains start vertex of an edge from column edge_id.</p>
<p>To describe turn restrictions:</p>
<blockquote>
gid | source | target | cost | x1 | y1 | x2 | y2 | to_cost | rule</blockquote>
<dl class="docutils">
<dt>&#8212;&#8211;+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;-+&#8212;-+&#8212;-+&#8212;-+&#8212;&#8212;&#8212;+&#8212;&#8212;</dt>
<dd>12 |      3 |     10 |    2 |  4 |  3 |  4 |  5 |    1000 | 14</dd>
</dl>
<p>means that the cost of going from edge 14 to edge 12 is 1000, and</p>
<blockquote>
gid | source | target | cost | x1 | y1 | x2 | y2 | to_cost | rule</blockquote>
<dl class="docutils">
<dt>&#8212;&#8211;+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;-+&#8212;-+&#8212;-+&#8212;-+&#8212;&#8212;&#8212;+&#8212;&#8212;</dt>
<dd>12 |      3 |     10 |    2 |  4 |  3 |  4 |  5 |    1000 | 14, 4</dd>
</dl>
<p>means that the cost of going from edge 14 to edge 12 through edge 4 is 1000.</p>
<p>If you need multiple restrictions for a given edge then you have to add multiple records for that edge each with a separate restriction.</p>
<blockquote>
gid | source | target | cost | x1 | y1 | x2 | y2 | to_cost | rule</blockquote>
<dl class="docutils">
<dt>&#8212;&#8211;+&#8212;&#8212;&#8211;+&#8212;&#8212;&#8211;+&#8212;&#8212;+&#8212;-+&#8212;-+&#8212;-+&#8212;-+&#8212;&#8212;&#8212;+&#8212;&#8212;</dt>
<dd>11 |      3 |     10 |    2 |  4 |  3 |  4 |  5 |    1000 | 4
11 |      3 |     10 |    2 |  4 |  3 |  4 |  5 |    1000 | 12</dd>
</dl>
<p>means that the cost of going from either edge 4 or 12 to edge 11 is 1000. And then you always need to order your data by gid when you load it to a shortest path function..</p>
<p>Example of Shooting-Star core function</p>
<dl class="docutils">
<dt>SELECT * FROM shortest_path_shooting_star(&#8216;</dt>
<dd><blockquote class="first">
<dl class="docutils">
<dt>SELECT gid as id,</dt>
<dd><blockquote class="first">
source::integer,
target::integer,
length::double precision as cost,
x1, y1, x2, y2,
rule, to_cost</blockquote>
<p class="last">FROM ways&#8217;,</p>
</dd>
</dl>
<p>293, 761, false, false);</p>
</blockquote>
<p class="last">vertex_id | edge_id |        cost</p>
</dd>
<dt>&#8212;&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</dt>
<dd><p class="first">4232 |     293 |  0.0059596293824534
3144 |     293 |  0.0059596293824534
4232 |    4632 |  0.0846731039249787</p>
<blockquote class="last">
<dl class="docutils">
<dt>... |     ... |  ...</dt>
<dd>51 |     761 |  0.0305298478239596</dd>
</dl>
</blockquote>
</dd>
</dl>
<p>(63 rows)
Wrapper function WITH bounding box</p>
<p>Wrapper functions extend the core functions with transformations, bounding box limitations, etc..</p>
<dl class="docutils">
<dt>SELECT gid, AsText(the_geom) AS the_geom</dt>
<dd><blockquote class="first">
FROM shootingstar_sp(&#8216;ways&#8217;, 293, 761, 0.1, &#8216;length&#8217;, true, true);</blockquote>
<p class="last">gid   |                              the_geom</p>
</dd>
<dt>&#8212;&#8212;&#8211;+&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</dt>
<dd><blockquote class="first">
293 | MULTILINESTRING((18.4074149 -33.9443308,18.4074019 -33.9443833))
293 | MULTILINESTRING((18.4074149 -33.9443308,18.4074019 -33.9443833))</blockquote>
<dl class="last docutils">
<dt>4632 | MULTILINESTRING((18.4074149 -33.9443308,18.4077388 -33.9436183))</dt>
<dd>... | ...
762 | MULTILINESTRING((18.4241422 -33.9179275,18.4237423 -33.9182966))
761 | MULTILINESTRING((18.4243523 -33.9177154,18.4241422 -33.9179275))</dd>
</dl>
</dd>
</dl>
<p>(62 rows)
Note:</p>
<p>There is currently no wrapper function for A-Star without bounding box, since bounding boxes are very useful to increase performance. If you don&#8217;t need a bounding box Dijkstra will be enough anyway.
The projection of OSM data is &#8220;degree&#8221;, so we set a bounding box containing start and end vertex plus a 0.1 degree buffer for example.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">6. pgRouting Shortest Path Search</a><ul>
<li><a class="reference external" href="#pgrouting-with-dijkstra-algorithm">6.1. pgRouting with Dijkstra algorithm</a></li>
<li><a class="reference external" href="#pgrouting-with-a-star-algorithm">6.2. pgRouting with A-Star algorithm</a></li>
<li><a class="reference external" href="#pgrouting-with-shooting-star-algorithm">6.3. pgRouting with Shooting-Star algorithm</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="topology.html"
                                  title="previous chapter">5. Load your network data and create a network topology</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="advanced.html"
                                  title="next chapter">7. Advanced usage of pgRouting shortest path search</a></p>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="advanced.html" title="7. Advanced usage of pgRouting shortest path search"
             >next</a> |</li>
        <li class="right" >
          <a href="topology.html" title="5. Load your network data and create a network topology"
             >previous</a> |</li>
        <li><a href="../index.html">Workshop - FOSS4G routing with pgRouting tools, OpenStreetMap road data and GeoExt v1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Daniel Kastl, Frédéric Junod.
      Last updated on Jul 04, 2010.
    </div>
  </body>
</html>