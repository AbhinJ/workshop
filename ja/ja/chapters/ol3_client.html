

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>10. OpenLayers 3 ブラウザクライアント &mdash; Workshop - FOSS4G routing with pgRouting</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Workshop - FOSS4G routing with pgRouting" href="../index.html" />
    <link rel="prev" title="9. GeoServer による WMS サーバー" href="geoserver.html" />
	<script type="text/javascript">
	/* <![CDATA[ */
	    (function() {
	        var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];
	        s.type = 'text/javascript';
	        s.async = true;
	        s.src = 'http://api.flattr.com/js/0.6/load.js?mode=auto';
	        t.parentNode.insertBefore(s, t);
	    })();
	/* ]]> */</script>

	<style>
		.toctree-wrapper {
			-webkit-column-count: 2;
			-moz-column-count: 2;
			column-count: 2;
		}
	</style>

  </head>
  <body>
    <div class="related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="geoserver.html" title="9. GeoServer による WMS サーバー"
             accesskey="P">前へ</a></li>
        <li><a href="../index.html">Workshop - FOSS4G routing with pgRouting</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="openlayers-3-browser-client">
<span id="ol3"></span><h1>10. OpenLayers 3 ブラウザクライアント<a class="headerlink" href="#openlayers-3-browser-client" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>この章の目的は、OpenLayers 3 により pgRouting への簡単なウェブベースのユーザーインターフェイスを作成することです。地図上でクリックすることにより、経路探索の始点と目的地の場所を選択することが可能となります。</p>
<p>このアプリケーションの全体的なワークフローは、始点と目的地のポイントが確定されるまで待ち、それから、これらの値を経路探索結果をデータベースに問い合わせる WMS サーバーに送信します。結果は WMS サーバーにより画像として表され、アプリケーションに返却された後、表示されます。</p>
<div class="section" id="openlayers-3-introduction">
<h2>10.1. OpenLayers 3 入門<a class="headerlink" href="#openlayers-3-introduction" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>OpenLayers 3 はOpenLayers 2 を完全に書き直したもので、現行の Canvas や WebGL といった現行の JavaScript と HTML5 技術を使用しています。本マニュアル記述時点では、バージョン 2 の全ての機能は移植されていませんが、コアの機能については利用可能です。</p>
<p>新しいコードは <a class="reference external" href="https://developers.google.com/closure/">Google Closure Tools</a> をベースとしており、これにより広範囲の良くテストされたライブラリを使用することが可能です。(Closure Library はまた、Gmail や Google Maps、さらに Google のウェブアプリケーションのほとんどのビルドに使用されています)。しかし、最も強力なツールは、Closure Compiler という Java ベースのコンパイラで、未使用コードの除去、最適化、JavaScript の最小化を可能とします。これらのツールは OpenLayers ライブラリのユーザーにとっては完全にオプションです。通常は、今回のワークショップで行うのと同様に、コンパイルされたコードをダウンロードし、それを使用するだけで構いません。</p>
<p>では、OpenLayers 3 のいくつかのキーコンセプトを見ていきましょう。</p>
<p>ライブラリの心臓部にはマップ(<tt class="docutils literal"><span class="pre">ol.Map</span></tt> クラス)があり、レイヤー、コントロール、ビュー、そしてレンダラーの管理を担当しています。</p>
<p>それぞれのマップは、HTML 要素へのレイヤーの描画を担当するレンダラーを持っています。レンダラーには、以下の3つの種類があります。</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ol.renderer.dom</span></tt> DOM ベースのレンダラーで、HTML の img タグのグリッドを使用します。この種の仕組みは、OpenLayers 2 や Leaflet でも使用されています。このレンダラーは、レンダラーの中で最も速度が遅く、最低限のテストしか行われていません。このレンダラーは使用しないでください...</li>
<li><tt class="docutils literal"><span class="pre">ol.renderer.canvas</span></tt> は Canvas ベースのレンダラーで、一つの canvas タグを使用し、レイヤーから取得される全てのタイルをその中に連結します。この仕組みは、Nokia の HERE(<a class="reference external" href="http://m.here.com">http://m.here.com</a>) のモバイルバージョンでも使用されています。</li>
<li><tt class="docutils literal"><span class="pre">ol.renderer.webgl</span></tt> Canvas レンダラーと同様ですが、WebGL を使用しています。WebGL は新しいバージョンの Google Maps でも使用されています。今のところ、2D ナビゲーションのみサポートされています。</li>
</ul>
<p>ビュー(<tt class="docutils literal"><span class="pre">ol.View</span></tt> クラス)はマップ上に何を表示するかを表します。 マップの地理的中心や解像度だけでなく、回転角も含まれます。他のライブラリと異なり、これらの値はマップのオブジェクトからは切り離されています。このことによる一つの優位性として、同一のビューを複数のマップで共有することが可能となることがあります。(例えば <a class="reference external" href="http://ol3js.org/en/master/examples/preload.html">こちらのサンプル</a> のように)</p>
</div>
<div class="section" id="creating-a-minimal-map">
<h2>10.2. 最小限の地図の作成<a class="headerlink" href="#creating-a-minimal-map" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>では、最初の OpenLayers 3 地図作成を開始しましょう。テキストエディタを開き、以下のコードをコピーして <tt class="docutils literal"><span class="pre">ol3.html</span></tt> という名前のファイルを作成します。このファイルは、Desktop に保存して、ウェブブラウザで開くことができます。</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>ol3 pgRouting client<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;ol3/ol.css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
      <span class="nf">#ol-map</span> <span class="p">{</span>
        <span class="k">width</span><span class="o">:</span> <span class="m">100</span><span class="o">%</span><span class="p">;</span>
        <span class="k">height</span><span class="o">:</span> <span class="m">400px</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;ol3/ol.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;ol-map&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>

    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>

      <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;ol-map&#39;</span><span class="p">,</span>
        <span class="nx">renderer</span><span class="o">:</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">RendererHint</span><span class="p">.</span><span class="nx">CANVAS</span><span class="p">,</span>
        <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
          <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">TileLayer</span><span class="p">({</span>
            <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">OSM</span><span class="p">()</span>
          <span class="p">})</span>
        <span class="p">],</span>
        <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View2D</span><span class="p">({</span>
          <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">127998</span><span class="p">,</span> <span class="mi">6974591</span><span class="p">],</span>
          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">10</span>
        <span class="p">})</span>
      <span class="p">});</span>

    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
<p>このコードは、Nottingham を中心とした OpenStreetMap レイヤーの地図を表示します。</p>
<p>現時点では、経路探索に関連するコードはなく、標準的なナビゲーションのみとなります。</p>
<dl class="docutils">
<dt>各行では以下を行っています。</dt>
<dd><ul class="first last simple">
<li>6 行目: デフォルトの OpenLayers CSS ファイルを読み込みます。</li>
<li>8 から 11 行目: マップにサイズ: 400px の高さとページ幅全体を割り当てます。</li>
<li>13 行目: OpenLayers のコードを読み込みます。全ての関数と JavaScript クラスは、この読み込みにより、 <tt class="docutils literal"><span class="pre">ol</span></tt> で始まっています。</li>
<li>16 行目: <tt class="docutils literal"><span class="pre">ol-map</span></tt> という id で、div を作成します。地図はこの div の内側に表示されます。</li>
</ul>
</dd>
</dl>
<p>ファイルの残りの箇所(<tt class="docutils literal"><span class="pre">script</span></tt> タグの内側)に、経路探索のためのサーバーへの問い合わせと結果表示のための JavaScript コードが含まれる形になります。</p>
<p>一旦、ウェブブラウザでページを開き、JavaScript コンソールを表示して、<tt class="docutils literal"><span class="pre">map</span></tt> オブジェクトにアクセスしてみます。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">map</span><span class="p">.</span><span class="nx">getView</span><span class="p">().</span><span class="nx">getCenter</span><span class="p">();</span>
<span class="nx">map</span><span class="p">.</span><span class="nx">getView</span><span class="p">().</span><span class="nx">setCenter</span><span class="p">([</span><span class="o">-</span><span class="mi">29686</span><span class="p">,</span> <span class="mi">6700403</span><span class="p">]);</span>

<span class="nx">map</span><span class="p">.</span><span class="nx">getView</span><span class="p">().</span><span class="nx">setRotation</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">ノート</p>
<p class="last">コンソールを使用して OpenLayers のオブジェクトを調査すると、ほとんどのプロパティと関数が短い(難読化された)名称を持つことが分かるでしょう。これは、Google Closure Compiler が元の名称をリネームしていることによります。このコンパイルの目的は、可能な限り小さいライブラリを生成することにあります。</p>
</div>
</div>
<div class="section" id="wms-get-parameters">
<h2>10.3. WMS GET パラメータ<a class="headerlink" href="#wms-get-parameters" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下のコードを <tt class="docutils literal"><span class="pre">script</span></tt> タグの末尾に追加します。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">LAYERS</span><span class="o">:</span> <span class="s1">&#39;pgrouting:pgrouting&#39;</span><span class="p">,</span>
  <span class="nx">FORMAT</span><span class="o">:</span> <span class="s1">&#39;image/png&#39;</span>
<span class="p">};</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">params</span></tt> オブジェクトは GeoServer に送信される WMS GET パラメータを保持します。ここでは、変更されることのない値: レイヤー名称と出力フォーマット を設定します。</p>
</div>
<div class="section" id="select-the-start-and-final-destination">
<h2>10.4. 始点と最終目的地の選択<a class="headerlink" href="#select-the-start-and-final-destination" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>地図上でのクリックにより、ユーザーに始点と目的地の位置を設定させることが必要です。</p>
<p>以下の2つの div を地図の要素内に追加します。</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;ol-map&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;start-point&quot;</span><span class="nt">&gt;</span>start<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;final-point&quot;</span><span class="nt">&gt;</span>final<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p>以下のコードを <tt class="docutils literal"><span class="pre">script</span></tt> タグの末尾に追加します。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">startPoint</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Overlay</span><span class="p">({</span>
  <span class="nx">map</span><span class="o">:</span> <span class="nx">map</span><span class="p">,</span>
  <span class="nx">element</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;start-point&#39;</span><span class="p">)</span>
<span class="p">});</span>
<span class="kd">var</span> <span class="nx">finalPoint</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Overlay</span><span class="p">({</span>
  <span class="nx">map</span><span class="o">:</span> <span class="nx">map</span><span class="p">,</span>
  <span class="nx">element</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;final-point&#39;</span><span class="p">)</span>
<span class="p">});</span>
</pre></div>
</div>
<p>上記は、2つのオーバーレイを作成し、地図への参照を与えます。なぜなら、オーバーレイはビューにしたがって位置を更新する必要があるからです。(端的に言うと、オーバーレイは地図の移動の際に、同時に移動します)</p>
<p>オーバーレイは位置が与えられていない(<tt class="docutils literal"><span class="pre">undefined</span></tt> と等しい)ので、表示されません。</p>
<p>以下のコードを <tt class="docutils literal"><span class="pre">script</span></tt> タグの末尾に追加します。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">transform</span> <span class="o">=</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">proj</span><span class="p">.</span><span class="nx">getTransform</span><span class="p">(</span><span class="s1">&#39;EPSG:3857&#39;</span><span class="p">,</span> <span class="s1">&#39;EPSG:4326&#39;</span><span class="p">);</span>

<span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">coordinate</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">getCoordinate</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">startPoint</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">()</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// first click</span>
    <span class="nx">startPoint</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">coordinate</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">finalPoint</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">()</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// second click</span>
    <span class="nx">finalPoint</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">coordinate</span><span class="p">);</span>

    <span class="c1">// transform the coordinates from the map projection (EPSG:3857)</span>
    <span class="c1">// into the server projection (EPSG:4326)</span>
    <span class="kd">var</span> <span class="nx">startCoord</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">(</span><span class="nx">startPoint</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">());</span>
    <span class="kd">var</span> <span class="nx">finalCoord</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">(</span><span class="nx">finalPoint</span><span class="p">.</span><span class="nx">getPosition</span><span class="p">());</span>
    <span class="kd">var</span> <span class="nx">viewparams</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s1">&#39;x1:&#39;</span> <span class="o">+</span> <span class="nx">startCoord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;y1:&#39;</span> <span class="o">+</span> <span class="nx">startCoord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
      <span class="s1">&#39;x2:&#39;</span> <span class="o">+</span> <span class="nx">finalCoord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;y2:&#39;</span> <span class="o">+</span> <span class="nx">finalCoord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">];</span>
    <span class="nx">params</span><span class="p">.</span><span class="nx">viewparams</span> <span class="o">=</span> <span class="nx">viewparams</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">);</span>

    <span class="c1">// we now have the two points, create the result layer and add it to the map</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">ImageLayer</span><span class="p">({</span>
      <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">SingleImageWMS</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://localhost:8082/geoserver/pgrouting/wms&#39;</span><span class="p">,</span>
        <span class="nx">params</span><span class="o">:</span> <span class="nx">params</span>
      <span class="p">})</span>
    <span class="p">});</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>地図がクリックされた時に、この関数が実行されます。カーソルの地理的な位置がオーバーレイに格納され、副次的効果として、オーバーレイが表示されます。</p>
<p>一度、始点と目的地のポイントが(2度のクリックにより)確定すると、2つの座標値のペアは、地図の投影法(<tt class="docutils literal"><span class="pre">EPSG:3857</span></tt>)からサーバーの投影法(<tt class="docutils literal"><span class="pre">EPSG:4326</span></tt>)に <tt class="docutils literal"><span class="pre">transform</span></tt> 関数を使用して変換されます。</p>
<p><tt class="docutils literal"><span class="pre">viewparams</span></tt> プロパティは WMS GET パラメータオブジェクトに設定されます。このプロパティの値は特別な意味を持ちます。GeoServer はこのレイヤのための SQL クエリを実行する前に、この値を代用します。例えば、もし</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">ways</span> <span class="k">WHERE</span> <span class="n">maxspeed_forward</span> <span class="k">BETWEEN</span> <span class="o">%</span><span class="k">min</span><span class="o">%</span> <span class="k">AND</span> <span class="o">%</span><span class="k">max</span><span class="o">%</span>
</pre></div>
</div>
<p>で <tt class="docutils literal"><span class="pre">viewparams</span></tt> が <tt class="docutils literal"><span class="pre">viewparams=min:20;max:120</span></tt> の場合、PostGIS に送信されるクエリは以下のようになります。</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">ways</span> <span class="k">WHERE</span> <span class="n">maxspeed_forward</span> <span class="k">BETWEEN</span> <span class="mi">20</span> <span class="k">AND</span> <span class="mi">120</span>
</pre></div>
</div>
<p>最後に、param オブジェクトが渡された、新しい OpenLayers WMS レイヤーが作成されて、マップに追加されます。</p>
</div>
<div class="section" id="clear-the-results">
<h2>10.5. 結果のクリア<a class="headerlink" href="#clear-the-results" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下のコードを地図の html の <tt class="docutils literal"><span class="pre">div</span></tt> と <tt class="docutils literal"><span class="pre">script</span></tt> タグの間に追加します。</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">&quot;clear&quot;</span><span class="nt">&gt;</span>clear<span class="nt">&lt;/button&gt;</span>
</pre></div>
</div>
<p>上記により、経路探索ポイントをクリアし、新しい経路探索クエリを開始することを可能にするボタンが作成されます。</p>
<p>以下のコードを <tt class="docutils literal"><span class="pre">script</span></tt> タグの末尾に追加します。</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// hide the overlays</span>
  <span class="nx">startPoint</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>
  <span class="nx">finalPoint</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>

  <span class="c1">// hide the result layer</span>
  <span class="nx">result</span><span class="p">.</span><span class="nx">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>ボタンがクリックされた時に、この関数が実行されます。経路探索ポイントと結果レイヤーは非表示となります。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/pgrouting.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">10. OpenLayers 3 ブラウザクライアント</a><ul>
<li><a class="reference internal" href="#openlayers-3-introduction">10.1. OpenLayers 3 入門</a></li>
<li><a class="reference internal" href="#creating-a-minimal-map">10.2. 最小限の地図の作成</a></li>
<li><a class="reference internal" href="#wms-get-parameters">10.3. WMS GET パラメータ</a></li>
<li><a class="reference internal" href="#select-the-start-and-final-destination">10.4. 始点と最終目的地の選択</a></li>
<li><a class="reference internal" href="#clear-the-results">10.5. 結果のクリア</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="geoserver.html"
                        title="前の章へ">9. GeoServer による WMS サーバー</a></p>
	
<div id="searchbox" style="display: none">
  <h3>クイック検索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    モジュール、クラス、または関数名を入力してください
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
	<h3>License</h3>
	<p style="font-size: 90%; margin-top:2px;">This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0 License</a>.</p>
	<p style="margin:0 0 10px 0;"><a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a></p>

	<!-- <p>
		<a class="FlattrButton" style="display:none;" rev="flattr;button:compact;" href="http://workshop.pgrouting.org"></a>
		<noscript><a href="http://flattr.com/thing/977418/pgRouting-Workshop" target="_blank">
		<img src="http://api.flattr.com/button/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0" /></a></noscript>
	</p> -->

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="geoserver.html" title="9. GeoServer による WMS サーバー"
             >前へ</a></li>
        <li><a href="../index.html">Workshop - FOSS4G routing with pgRouting</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2013 Hal Seki, Yves Jacolin, Daniel Kastl, Frédéric Junod.
      最終更新: Oct 30, 2013
    </div>
  </body>
</html>